<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    html,body,#app{
        width: 100%;
        margin: 0;
        padding: 0;
    }

    #app{
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .box{
        margin-top: 25px;
    }

    .title{
        font-size: 3rem;
    }

    .list{
        margin-top: 25px;
    }

    ul{
        padding: 0;
        margin: 0;
    }

    li{
        list-style: none;
        font-size: 1.3rem;
        cursor: pointer;
    }

    
</style>
<body>
    <div id="app">
        <div class="box">
            <span class="title">FileList</span>
            <nav class="list">
                <ul id="ulRoot" layer="0"></ul>
            </nav>
        </div>
    </div>
</body>
<script>
    var attr_dir   = "dir"
    var attr_layer = "layer"
    var attr_path  = "path"
    var attr_load  = "load"
    var lis,
        resNodeCount = 0,
        flagFile     = 0,
        flagDir      = 1,
        flagNotLoad  = 0,
        flagLoaded   = 1
    var ulRoot = document.getElementById("ulRoot")
    var mPath  = window.location.href
    var local  = mPath.substring(mPath.lastIndexOf("/") + 1,mPath.length)
        mPath  = mPath.substring(0,mPath.lastIndexOf("/"))
        mPath  = mPath.replace("file:///","")
    console.log(mPath)
    var fso	   = new ActiveXObject("Scripting.FileSystemObject")

    function load(path,ul){
        loadFile(path,ul)
        loadDir(path,ul)
        listenLiClick()
    }

    function loadFile(path,ul){
        var fldr  = fso.GetFolder(path)
        var fc    = new Enumerator(fldr.files)
        var layer = parseInt(ul.getAttribute(attr_layer)) + 1
        for(;!fc.atEnd();fc.moveNext()){
            var s = fc.item()
            if(s.name == local)
                continue
            var li = document.createElement("li")
            li.setAttribute(attr_dir,flagFile)
            li.setAttribute(attr_layer,layer)
            li.setAttribute(attr_path,ul.getAttribute(attr_path) + "/" + s.name)
            li.setAttribute("style","text-indent:" + 12 * (layer-1) + "px")
            li.innerHTML = s.name
            ul.appendChild(li)
        }
    }

    function loadDir(path,ul){
        var fldr = fso.GetFolder(path)
        var folder = new Enumerator(fldr.SubFolders)
        var layer = parseInt(ul.getAttribute(attr_layer)) + 1
        for (;!folder.atEnd(); folder.moveNext()){
            var s  = folder.item()
            var li = document.createElement("li")
            li.setAttribute(attr_dir,flagDir)
            li.setAttribute(attr_path,ul.getAttribute(attr_path) + "/" + s.name)
            li.setAttribute(attr_layer,layer)
            li.setAttribute(attr_load,flagNotLoad)
            li.setAttribute("style","text-indent:" + 12 * (layer-1) + "px")
            li.innerHTML = s.name
            ul.appendChild(li)
        }
    }

    function listenLiClick(){ 
        lis = document.getElementsByTagName("li")
        for(var i = 0; i < lis.length; i++){
            lis[i].onclick = function(){
                // 避免点击事件传递给父节点
                resNodeCount += 1
                if(resNodeCount > 1)
                    return
                setTimeout(function(){
                    resNodeCount = 0
                },100)
                if(this.getAttribute(attr_dir) == flagDir){
                    editDir(this)
                }
                else{
                    //window.location.href = this.getAttribute(attr_path)
                    window.open(this.getAttribute(attr_path),"_blank")
                }
            }
        }
    }

    function editDir(li){
        if(li.getAttribute(attr_load) == flagNotLoad){
            var ul = document.createElement("ul")
            ul.setAttribute("id",li.getAttribute(attr_path))
            ul.setAttribute(attr_layer,li.getAttribute(attr_layer))
            ul.setAttribute(attr_path,li.getAttribute(attr_path))
            li.appendChild(ul)
            li.setAttribute(attr_load,flagLoaded)
            load(li.getAttribute(attr_path),ul)
        }
        else{
            var child = document.getElementById((li.children[0].id))
            var display = child.style.display
            child.style.display = display == "" ? "none" : ""
        }
    }

    ulRoot.setAttribute(attr_path,mPath)
    load(mPath,ulRoot)
</script>
</html>
