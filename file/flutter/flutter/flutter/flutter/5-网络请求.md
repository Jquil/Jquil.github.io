# 前言

> dio 是一个强大的 Dart Http请求库，支持 Restful API、FormData、拦截器、请求取消、Cookie 管理、文件上传/下载、超时、自定义适配器等.

<div align='center'>

![](https://tse1-mm.cn.bing.net/th/id/OIP-C.Vfrd9m6yfWWwSHb71YDtRQHaEK?w=493&h=280&c=&o=&pid=)
</div>


# 使用

首先我们到「[这里](https://pub.dev/packages/dio)」查看dio的最新版本号，并添加到依赖上：
```
dependencies:
  dio: ^4.0.0   // 我看的时候是4.0版本
```

然后最简单的例子：
```
import 'package:dio/dio.dart';
void getHttp() async {
  try {
    var response = await Dio().get('http://www.baidu.com');
    print(response);
  } catch (e) {
    print(e);
  }
}
```


携带参数的区别：
```
// get
await Dio().get('http://www.baidu.com',queryParameter:{ "id":1,"name":"Jq" });

// post
await Dio().post('http://www.baidu.com',data:{ ... })
```


以及下载文件：
```
await Dio().download('https://www.google.com/', './xx.html');
```

等等.....


# 配置

我们同样也用单例模式实现：`lib>http>myDio.dart`

```
var dio = Dio(); // with default Options

// Set default configs
dio.options.baseUrl = 'https://www.xx.com/api';
dio.options.connectTimeout = 5000; //5s
dio.options.receiveTimeout = 3000;

// or new Dio with a BaseOptions instance.
var options = BaseOptions(
  baseUrl: 'https://www.xx.com/api',
  connectTimeout: 5000,
  receiveTimeout: 3000,
);
Dio dio = Dio(options);
```

# 自动解析请求框架

Android中会有这么一套请求解析工具：「okhttp + retrofit + rxjava」很大程度上解放了双手，那么在Flutter中是否也可以呢？

答案是肯定的 => [flutter dio+rxdart+retrofit 自动解析请求框架](https://juejin.cn/post/6844903833684934670)

\>> **加入依赖**：
```
dependencies:
    ...
    retrofit: any
    logger: any             # 打印日志
    rxdart: ^0.26.0
    json_annotation: 4.0.0  # JSON转换
```

\>> **写个Bean**: `lib>bean>SongBean.dart`
```
import 'package:json_annotation/json_annotation.dart';

part 'SongBean.g.dart';

@JsonSerializable()
class SongBean {

  String singer;
  String songName;

  LoginBean({this.singer,  this.songName});

  factory SongBean.fromJson(Map<String, dynamic> json) =>
      _$SongBeanFromJson(json);

  Map<String, dynamic> toJson() => _$SongBeanToJson(this);

}
```



\>> **编写API服务**：`lib>http>ApiService.dart`
```
import 'package:retrofit/retrofit.dart';
import 'package:dio/dio.dart';

part 'ApiService.g.dart';

@RestApi(baseUrl: "http://www.baidu.com")
abstract class ApiService {

  factory ApiService(Dio dio, {String baseUrl}) => _ApiService(dio);

  //查询
  @POST("/search")
  Future<SongBean> search(@Field('key') String key);

}
```

\>> **调用**：
```
Dio dio = await Api().getDio();
var apiService = ApiService(dio);
var logger = Logger(); //log打印

//请求接口
var stream = Stream.value(apiService.search("search-key"));

stream.listen((data) async{
    //接口请求成功
    SongBean song = await  data ;
    logger.i(song.toJson().toString());
},onError: (e){
    logger.i(e);
});
```

# 小结


最后，在重新附上学习文章：

1. [Dio - pub.dev](https://pub.dev/packages/dio)

1. [flutter dio+rxdart+retrofit 自动解析请求框架](https://juejin.cn/post/6844903833684934670)

