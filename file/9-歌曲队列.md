# 前言

在需求中需要实现一个歌曲播放队列，但在Dart语言中不支持Queue这种数据结构，只好自己动手~

# 实现
```
class PlayQueue extends ChangeNotifier{

    /*
        流程大致如下：
            1. 点击音乐，设置数据 - 更新播放队列 - 更新当前播放音乐（Provider）
            2. 播放 - 第一条数据出列
            3. 监听音乐播放
                3.1 更新播放进度（Provider）
                3.2 播放完成，执行next()，播放下一首
    */
    
    // 验证是否本身为单例

    final maxSize = 100;

    List<Song> _playList = List(maxSize);

    bool disposed = false;

    void _pushAll(List<Song> list){
        popAll();
        _playList.addAll(list);
        _doTask();
    }

    void _pop(){
        _playList.removeAt(0);
    }

    void _popAll(){
        _playList = [];
    }

    void _doTask(){
        // 播放 -- 实现播放逻辑

        // 更新 -- 当前播放歌曲 = `BuildContext context = navigatorKey.currentState.overlay.context` 试试可否拿到SongProvider并更新
        https://blog.csdn.net/sinat_17775997/article/details/107227354

        pop();
    }

    // 暴露给外部设置
    void setData(List<Song> data,int position){
        _pushAll(data.sublist(position, data.length));
        notifyListeners();
    }

    void next(){
        if(_playList.length - 1 > 0){
            _pop();
            _doTask();
        }
    }

    @override  
    void dispose() {
        super.dispose();
        disposed = true;
    }

    @override
    void notifyListeners() {
        if (!disposed) {
            super.notifyListeners();
        }
    }
}
```

不实现播放上一首歌曲的功能

[Flutter:Dart数组(List)基本属性与操作笔记](https://www.jianshu.com/p/bfa198721994)

[Flutter实现队列](https://blog.csdn.net/u014377146/article/details/117256046)



